# PixelCanvas ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹é©å‘½: PixiJS + LOD ç§»è¡Œè¨ˆç”»

## ðŸ“‹ ç¾åœ¨ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åˆ†æž

### ðŸ” ç¾çŠ¶ã‚·ã‚¹ãƒ†ãƒ 
- **ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**: Canvas 2D API (CPUæç”»)
- **ãƒ¬ã‚¤ãƒ¤ãƒ¼**: 5æ®µéšŽã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ãƒ¤ãƒ¼ (pixels â†’ blocks â†’ tiles â†’ chunks â†’ regions)
- **ãƒ‡ãƒ¼ã‚¿**: Supabase REST API + å˜ä¸€è§£åƒåº¦ãƒ”ã‚¯ã‚»ãƒ«
- **ã‚«ãƒ¡ãƒ©**: ã‚«ã‚¹ã‚¿ãƒ EventHandlers (ãƒ‘ãƒ³&ã‚ºãƒ¼ãƒ )
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: PixelStorage (Map-based ãƒ¡ãƒ¢ãƒªç®¡ç†)

### âš ï¸ ç¾åœ¨ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯
1. **CPUæç”»é™ç•Œ**: Canvas 2D APIã§ã®å¤§é‡ãƒ”ã‚¯ã‚»ãƒ«æç”»
2. **è»¢é€é‡çˆ†ç™º**: ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã®æŒ‡æ•°çš„ã‚»ã‚¯ã‚¿ãƒ¼å¢—åŠ 
3. **ãƒ¡ãƒ¢ãƒªåŠ¹çŽ‡**: å˜ä¸€è§£åƒåº¦ã§ã®å¤§é‡ãƒ‡ãƒ¼ã‚¿ä¿æŒ
4. **UIå¿œç­”æ€§**: ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã®é‡ã„å‡¦ç†

## ðŸŽ¯ ç›®æ¨™ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ðŸš€ æ–°ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
- **ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**: PixiJS + pixi-tilemap (GPUæç”»)
- **ã‚«ãƒ¡ãƒ©**: pixi-viewport (çµ±ä¸€2Dã‚«ãƒ¡ãƒ©)
- **LOD**: 4æ®µéšŽãƒ”ãƒ©ãƒŸãƒƒãƒ‰ (1x, 1/2, 1/4, 1/8)
- **ãƒ‡ãƒ¼ã‚¿**: Supabase Realtime + å‹•çš„LODåˆ‡ã‚Šæ›¿ãˆ
- **å‡¦ç†**: Web Workers (RLE decode, ImageBitmapç”Ÿæˆ)

## ðŸ“… æ®µéšŽçš„ç§»è¡Œæˆ¦ç•¥

### Phase 1: åŸºç›¤æº–å‚™ (1-2æ—¥)
- [ ] PixiJSç’°å¢ƒæ§‹ç¯‰ã¨ãƒ†ã‚¹ãƒˆ
- [ ] LODãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆãƒ»ä½œæˆ
- [ ] æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰LODãƒ”ãƒ©ãƒŸãƒƒãƒ‰ç”Ÿæˆ

### Phase 2: ä¸¦è¡Œã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰ (2-3æ—¥)  
- [ ] PixiJSãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å®Ÿè£…
- [ ] pixi-viewportçµ±åˆ
- [ ] LODå‹•çš„åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯

### Phase 3: çµ±åˆãƒ»æœ€é©åŒ– (1-2æ—¥)
- [ ] Supabase Realtimeçµ±åˆ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–
- [ ] è¨­å®šãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹åˆ‡ã‚Šæ›¿ãˆ

### Phase 4: å®Œå…¨ç§»è¡Œ (1æ—¥)
- [ ] æ—§ã‚·ã‚¹ãƒ†ãƒ å‰Šé™¤
- [ ] æœ€çµ‚èª¿æ•´ãƒ»ãƒ‡ãƒãƒƒã‚°

## ðŸ”§ æŠ€è¡“é¸å®š

### å¿…é ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª
```json
{
  "pixi.js": "^7.3.0",
  "@pixi/tilemap": "^4.2.0", 
  "pixi-viewport": "^5.0.0"
}
```

### LODãƒ”ãƒ©ãƒŸãƒƒãƒ‰æ§‹é€ 
```
Level 0: 256x256 (ãƒ•ãƒ«è§£åƒåº¦)
Level 1: 128x128 (1/2)
Level 2: 64x64   (1/4)  
Level 3: 32x32   (1/8)
```

### ã‚¹ã‚±ãƒ¼ãƒ«é–¾å€¤è¨­è¨ˆ
```
scale >= 2.0  â†’ Level 0 (256x256)
scale >= 0.5  â†’ Level 1 (128x128)
scale >= 0.125 â†’ Level 2 (64x64)
scale < 0.125 â†’ Level 3 (32x32)
```

## ðŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### sector_lod ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
CREATE TABLE public.sector_lod (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    sector_x INTEGER NOT NULL,
    sector_y INTEGER NOT NULL,
    lod_level INTEGER NOT NULL, -- 0,1,2,3
    width INTEGER NOT NULL,     -- 256,128,64,32
    height INTEGER NOT NULL,
    rle_data BYTEA,            -- RLEåœ§ç¸®ãƒ”ã‚¯ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿
    pixel_count INTEGER DEFAULT 0,
    last_updated TIMESTAMPTZ DEFAULT NOW(),
    
    UNIQUE(sector_x, sector_y, lod_level)
);

CREATE INDEX idx_sector_lod_coords ON sector_lod(sector_x, sector_y, lod_level);
CREATE INDEX idx_sector_lod_level ON sector_lod(lod_level);
```

## ðŸŽ® ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ç›®æ¨™

### æç”»æ€§èƒ½
- 60fps @ 1000+ ã‚»ã‚¯ã‚¿ãƒ¼è¡¨ç¤º
- <100ms LODåˆ‡ã‚Šæ›¿ãˆé…å»¶
- <50MB GPU ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

### é€šä¿¡åŠ¹çŽ‡  
- 90% è»¢é€é‡å‰Šæ¸› (LODã«ã‚ˆã‚‹)
- <200ms åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–° <100ms

## ðŸ”„ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥

1. **è¨­å®šãƒ•ãƒ©ã‚°**: `USE_PIXI_RENDERER` ã§åˆ‡ã‚Šæ›¿ãˆ
2. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: PixiJSå¤±æ•—æ™‚ã¯è‡ªå‹•çš„ã«æ—§ã‚·ã‚¹ãƒ†ãƒ 
3. **ãƒ‡ãƒã‚¤ã‚¹åˆ¤å®š**: ä½Žæ€§èƒ½ãƒ‡ãƒã‚¤ã‚¹ã¯æ—§ã‚·ã‚¹ãƒ†ãƒ ç¶™ç¶š
4. **æ®µéšŽå±•é–‹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å˜ä½ã§ã®æ–°ã‚·ã‚¹ãƒ†ãƒ æœ‰åŠ¹åŒ–

ã“ã‚Œã«ã‚ˆã‚Šå®‰å…¨ã§æ®µéšŽçš„ãªç§»è¡ŒãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚