<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="description" content="PixelCanvas - ÂÖ±Âêå„Éî„ÇØ„Çª„É´„Ç¢„Éº„Éà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†">
    <title>PixelCanvas - ÂÖ±Âêå„Éî„ÇØ„Çª„É´„Ç¢„Éº„Éà</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.webmanifest">
    
    <link rel="preconnect" href="https://lgvjdefkyeuvquzckkvb.supabase.co">
    <link rel="dns-prefetch" href="https://lgvjdefkyeuvquzckkvb.supabase.co">
</head>
<body>
    <header class="header">
        <h1 class="header__title">PixelCanvas</h1>
        <div class="header__controls">
            <button class="grid-toggle" id="gridToggle" aria-label="Toggle Grid">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M2 2h6v6H2V2zm10 0h6v6h-6V2zM2 12h6v6H2v-6zm10 0h6v6h-6v-6z" stroke="currentColor" stroke-width="1"/>
                </svg>
            </button>
            <div class="pixel-count" id="pixelCount">0px</div>
            <div class="cooldown-indicator" id="cooldownIndicator"></div>
            <span class="status-indicator" id="status"></span>
        </div>
    </header>

    <main class="main">
        <div class="canvas-container" id="canvasContainer">
            <canvas id="mainCanvas" class="canvas"></canvas>
            <div class="canvas-overlay" id="canvasOverlay"></div>
        </div>
    </main>

    <footer class="controls">
        <div class="color-palette" id="colorPalette">
            <button class="color-button" data-color="0" style="background-color: #000000" aria-label="Black"></button>
            <button class="color-button" data-color="1" style="background-color: #FFFFFF" aria-label="White"></button>
            <button class="color-button" data-color="2" style="background-color: #FF0000" aria-label="Red"></button>
            <button class="color-button" data-color="3" style="background-color: #00FF00" aria-label="Green"></button>
            <button class="color-button" data-color="4" style="background-color: #0000FF" aria-label="Blue"></button>
            <button class="color-button" data-color="5" style="background-color: #FFFF00" aria-label="Yellow"></button>
            <button class="color-button" data-color="6" style="background-color: #FF00FF" aria-label="Magenta"></button>
            <button class="color-button" data-color="7" style="background-color: #00FFFF" aria-label="Cyan"></button>
            <button class="color-button" data-color="8" style="background-color: #800000" aria-label="Dark Red"></button>
            <button class="color-button" data-color="9" style="background-color: #008000" aria-label="Dark Green"></button>
            <button class="color-button" data-color="10" style="background-color: #000080" aria-label="Dark Blue"></button>
            <button class="color-button" data-color="11" style="background-color: #808000" aria-label="Olive"></button>
            <button class="color-button" data-color="12" style="background-color: #800080" aria-label="Purple"></button>
            <button class="color-button" data-color="13" style="background-color: #008080" aria-label="Teal"></button>
            <button class="color-button" data-color="14" style="background-color: #C0C0C0" aria-label="Silver"></button>
            <button class="color-button" data-color="15" style="background-color: #808080" aria-label="Gray"></button>
        </div>
    </footer>

    <!-- vConsole for mobile debugging -->
    <script src="vconsole.min.js"></script>
    <script>
        // Initialize vConsole for debugging
        try {
            const isMobile = window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // Enable for mobile OR when URL contains debug=vconsole
            const forceVConsole = new URLSearchParams(window.location.search).get('debug') === 'vconsole';
            
            if (isMobile || forceVConsole) {
                const vConsole = new VConsole({
                    theme: 'dark',
                    defaultPlugins: ['system', 'network', 'element', 'storage'],
                    maxLogNumber: 2000,
                    onReady: function() {
                        console.log('üì± vConsole ready for debugging!');
                        console.warn('‚ö†Ô∏è Warning test message');
                        console.error('‚ùå Error test message');
                        
                        // „É≠„Ç∞„Ç≥„Éî„ÉºÊ©üËÉΩËøΩÂä†
                        setTimeout(() => {
                            addLogCopyFeature();
                        }, 500);
                    }
                });
                
                console.log(`üì± vConsole initialized - Mobile: ${isMobile}, Forced: ${forceVConsole}`);
                
                // Store reference globally for testing
                window.vConsole = vConsole;
            } else {
                console.log('üíª Desktop mode - vConsole disabled (add ?debug=vconsole to URL to force enable)');
            }
        } catch (error) {
            console.error('‚ùå Failed to initialize vConsole:', error);
        }
        
        // „É≠„Ç∞„Ç≥„Éî„ÉºÊ©üËÉΩ„ÅÆËøΩÂä†
        function addLogCopyFeature() {
            try {
                // vConsole„ÅÆDOMÊßãÈÄ†„ÇíË§áÊï∞„Éë„Çø„Éº„É≥„ÅßÊ§úÁ¥¢
                let consoleTab = null;
                let retryCount = 0;
                const maxRetries = 10;
                
                // Ë§áÊï∞„ÅÆ„Çª„É¨„ÇØ„Çø„Éº„Éë„Çø„Éº„É≥„ÇíË©¶„Åô
                const selectors = [
                    '#__vconsole .vc-tab[data-tab="default"]',
                    '#__vconsole .vc-tab[data-tab="console"]', 
                    '#__vconsole [data-tab="default"]',
                    '#__vconsole [data-tab="console"]',
                    '#__vconsole .vc-tabbar',
                    '#__vconsole .vc-switch',
                    '#__vconsole'
                ];
                
                for (const selector of selectors) {
                    consoleTab = document.querySelector(selector);
                    if (consoleTab) {
                        console.log(`‚úÖ Found vConsole element with selector: ${selector}`);
                        break;
                    }
                }
                
                if (!consoleTab) {
                    // DOMÊßãÈÄ†„Çí„É≠„Ç∞Âá∫Âäõ„Åó„Å¶„Éá„Éê„ÉÉ„Ç∞
                    const vconsoleElement = document.querySelector('#__vconsole');
                    if (vconsoleElement) {
                        console.log('üîç vConsole DOM structure:', vconsoleElement.innerHTML.substring(0, 500));
                        const allTabs = vconsoleElement.querySelectorAll('[class*="tab"], [data-tab]');
                        console.log('üîç Available tabs:', Array.from(allTabs).map(tab => ({
                            className: tab.className,
                            dataset: tab.dataset,
                            tagName: tab.tagName
                        })));
                    }
                    
                    retryCount++;
                    if (retryCount < maxRetries) {
                        console.warn(`vConsole element not found, retrying... (${retryCount}/${maxRetries})`);
                        setTimeout(addLogCopyFeature, 1000);
                        return;
                    } else {
                        console.error('‚ùå Failed to find vConsole after max retries');
                        // ÊúÄÂæå„ÅÆÊâãÊÆµ: vConsoleÂÖ®‰Ωì„Å´„Éú„Çø„É≥„ÇíËøΩÂä†
                        addFloatingCopyButton();
                        return;
                    }
                }
                
                // „Ç≥„Éî„Éº„Éú„Çø„É≥„ÇívConsoleÂÜÖ„Å´ËøΩÂä†
                if (!document.querySelector('.vc-copy-logs-btn')) {
                    // ÈÄöÂ∏∏„ÅÆ„Ç≥„Éî„Éº„Éú„Çø„É≥
                    const copyButton = document.createElement('button');
                    copyButton.className = 'vc-copy-logs-btn';
                    copyButton.innerHTML = 'üìã Copy Logs';
                    copyButton.style.cssText = `
                        position: fixed;
                        top: 60px;
                        right: 15px;
                        background: #4CAF50;
                        color: white;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 4px;
                        font-size: 12px;
                        cursor: pointer;
                        z-index: 99999;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                    `;
                    
                    copyButton.addEventListener('click', () => {
                        copyAllLogs();
                    });
                    
                    // Â±ïÈñã„Ç≥„Éî„Éº„Éú„Çø„É≥
                    const expandCopyButton = document.createElement('button');
                    expandCopyButton.className = 'vc-copy-logs-expanded-btn';
                    expandCopyButton.innerHTML = 'üîç Deep Copy';
                    expandCopyButton.style.cssText = `
                        position: fixed;
                        top: 100px;
                        right: 15px;
                        background: #FF9800;
                        color: white;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 4px;
                        font-size: 12px;
                        cursor: pointer;
                        z-index: 99999;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                    `;
                    
                    expandCopyButton.addEventListener('click', () => {
                        copyAllLogsExpanded();
                    });
                    
                    // vConsoleË¶ÅÁ¥†„Åæ„Åü„ÅØbody„Å´ËøΩÂä†
                    const vconsoleRoot = document.querySelector('#__vconsole') || document.body;
                    vconsoleRoot.appendChild(copyButton);
                    vconsoleRoot.appendChild(expandCopyButton);
                    console.log('‚úÖ Log copy buttons added to vConsole (normal + deep)');
                }
                
                // ÂêÑ„É≠„Ç∞„Ç®„É≥„Éà„É™„Å´„ÇÇ„Ç≥„Éî„Éº„Éú„Çø„É≥„ÇíËøΩÂä†„Åô„ÇãÈñ¢Êï∞
                function addCopyButtonsToLogs() {
                    const logList = document.querySelector('#__vconsole .vc-log-list');
                    if (logList) {
                        // „É≠„Ç∞„É™„Çπ„Éà„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
                        const observer = new MutationObserver(() => {
                            const logItems = logList.querySelectorAll('.vc-item:not(.vc-copy-added)');
                            logItems.forEach(item => {
                                if (!item.querySelector('.vc-copy-single-btn')) {
                                    const copyBtn = document.createElement('span');
                                    copyBtn.className = 'vc-copy-single-btn';
                                    copyBtn.innerHTML = 'üìã';
                                    copyBtn.style.cssText = `
                                        display: inline-block;
                                        margin-left: 8px;
                                        cursor: pointer;
                                        opacity: 0.6;
                                        font-size: 12px;
                                    `;
                                    copyBtn.title = 'Copy this log';
                                    
                                    copyBtn.addEventListener('click', (e) => {
                                        e.stopPropagation();
                                        const logContent = item.textContent.replace('üìã', '').trim();
                                        copyToClipboard(logContent);
                                        showCopyFeedback(copyBtn);
                                    });
                                    
                                    const logContent = item.querySelector('.vc-item-content');
                                    if (logContent) {
                                        logContent.appendChild(copyBtn);
                                    }
                                    item.classList.add('vc-copy-added');
                                }
                            });
                        });
                        observer.observe(logList, { childList: true, subtree: true });
                    }
                }
                
                // Â∞ë„ÅóÈÅÖÂª∂„Åó„Å¶„É≠„Ç∞„Éú„Çø„É≥„ÇÇËøΩÂä†
                setTimeout(addCopyButtonsToLogs, 500);
                
            } catch (error) {
                console.error('‚ùå Failed to add log copy feature:', error);
            }
        }
        
        // „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç≥„Éî„Éº„Éú„Çø„É≥„ÇíËøΩÂä†Ôºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
        function addFloatingCopyButton() {
            if (document.querySelector('.vc-floating-copy-btn')) return;
            
            // ÈÄöÂ∏∏„ÅÆ„Ç≥„Éî„Éº„Éú„Çø„É≥
            const floatingButton = document.createElement('button');
            floatingButton.className = 'vc-floating-copy-btn';
            floatingButton.innerHTML = 'üìã';
            floatingButton.title = 'Copy all vConsole logs';
            floatingButton.style.cssText = `
                position: fixed;
                bottom: 140px;
                right: 20px;
                width: 50px;
                height: 50px;
                background: #4CAF50;
                color: white;
                border: none;
                border-radius: 50%;
                font-size: 20px;
                cursor: pointer;
                z-index: 99999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            floatingButton.addEventListener('click', () => {
                copyAllLogs();
            });
            
            // Â±ïÈñã„Ç≥„Éî„Éº„Éú„Çø„É≥
            const floatingExpandButton = document.createElement('button');
            floatingExpandButton.className = 'vc-floating-expand-btn';
            floatingExpandButton.innerHTML = 'üîç';
            floatingExpandButton.title = 'Deep copy all vConsole logs (expanded)';
            floatingExpandButton.style.cssText = `
                position: fixed;
                bottom: 80px;
                right: 20px;
                width: 50px;
                height: 50px;
                background: #FF9800;
                color: white;
                border: none;
                border-radius: 50%;
                font-size: 20px;
                cursor: pointer;
                z-index: 99999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            floatingExpandButton.addEventListener('click', () => {
                copyAllLogsExpanded();
            });
            
            document.body.appendChild(floatingButton);
            document.body.appendChild(floatingExpandButton);
            console.log('‚úÖ Floating copy buttons added as fallback (normal + deep)');
        }
        
        // ÂÖ®„É≠„Ç∞„Çí„Ç≥„Éî„Éº„Åô„ÇãÈñ¢Êï∞
        function copyAllLogs() {
            try {
                console.log('üîç Starting vConsole log extraction...');
                
                // „Åæ„ÅövConsole„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´„Çø„Éñ„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´„Åô„Çã
                const consoleTab = document.querySelector('#__vconsole .vc-switch[data-tab="default"]') || 
                                  document.querySelector('#__vconsole .vc-switch[data-tab="console"]');
                if (consoleTab && !consoleTab.classList.contains('vc-actived')) {
                    consoleTab.click();
                    console.log('‚úÖ Console tab activated');
                    // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„Çâ„É≠„Ç∞ÊäΩÂá∫„ÇíÁ∂öË°å
                    setTimeout(() => copyAllLogs(), 200);
                    return;
                }
                
                // vConsole„ÅÆÂÜÖÈÉ®„É≠„Ç∞„Éá„Éº„Çø„Å´Áõ¥Êé•„Ç¢„ÇØ„Çª„Çπ„ÇíË©¶Ë°å
                let extractedLogs = [];
                
                // ÊñπÊ≥ï1: vConsole API„Åã„ÇâÁõ¥Êé•„É≠„Ç∞„ÇíÂèñÂæó
                if (window.vConsole && window.vConsole.tool) {
                    console.log('üîç Trying vConsole API method...');
                    try {
                        const logTool = window.vConsole.tool.default || window.vConsole.tool.console;
                        if (logTool && logTool.logList) {
                            console.log(`üìã Found ${logTool.logList.length} logs via API`);
                            logTool.logList.forEach((log, index) => {
                                const logData = Array.isArray(log.data) ? log.data.join(' ') : String(log.data);
                                const timestamp = log.date ? new Date(log.date).toLocaleTimeString() : 'unknown';
                                extractedLogs.push(`[${index + 1}] [${timestamp}] [${log.type.toUpperCase()}] ${logData}`);
                            });
                        }
                    } catch (error) {
                        console.log('‚ö†Ô∏è vConsole API method failed:', error);
                    }
                }
                
                // ÊñπÊ≥ï2: DOM„Åã„ÇâË©≥Á¥∞ÊäΩÂá∫ÔºàAPI„ÅåÂ§±Êïó„Åó„ÅüÂ†¥Âêà„ÅÆË£úÂÆåÔºâ
                if (extractedLogs.length === 0) {
                    console.log('üîç Trying DOM extraction method...');
                    const vconsolePanel = document.querySelector('#__vconsole .vc-tabpanel[data-tab="default"]') ||
                                         document.querySelector('#__vconsole .vc-tabpanel[data-tab="console"]');
                    
                    if (vconsolePanel) {
                        // „É≠„Ç∞„Ç¢„Ç§„ÉÜ„É†„ÇíÊé¢„Åô„Åü„ÇÅ„ÅÆÂåÖÊã¨ÁöÑ„Çª„É¨„ÇØ„Çø„Éº
                        const possibleLogContainers = [
                            '.vc-scroller',
                            '.vc-content', 
                            '.vc-panel-content',
                            '.vc-tabpanel-content'
                        ];
                        
                        for (const containerSelector of possibleLogContainers) {
                            const container = vconsolePanel.querySelector(containerSelector);
                            if (container) {
                                console.log(`üìç Found container: ${containerSelector}`);
                                
                                // ÂÖ®„Å¶„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Éé„Éº„Éâ„ÇíÂèéÈõÜ
                                const walker = document.createTreeWalker(
                                    container,
                                    NodeFilter.SHOW_ALL,
                                    {
                                        acceptNode: function(node) {
                                            // „Çπ„ÇØ„É™„Éó„Éà„Çø„Ç∞„ÇÑÈö†„ÅóË¶ÅÁ¥†„ÅØÈô§Â§ñ
                                            if (node.tagName === 'SCRIPT' || node.tagName === 'STYLE') {
                                                return NodeFilter.FILTER_REJECT;
                                            }
                                            if (node.style && node.style.display === 'none') {
                                                return NodeFilter.FILTER_REJECT;
                                            }
                                            return NodeFilter.FILTER_ACCEPT;
                                        }
                                    }
                                );
                                
                                let allText = '';
                                let node;
                                while (node = walker.nextNode()) {
                                    if (node.nodeType === Node.TEXT_NODE) {
                                        const text = node.textContent.trim();
                                        if (text && text.length > 0 && !text.match(/^[\s\n\r\t]*$/)) {
                                            allText += text + ' ';
                                        }
                                    } else if (node.nodeType === Node.ELEMENT_NODE) {
                                        // „É≠„Ç∞„Ç®„É≥„Éà„É™„Å£„ÅΩ„ÅÑË¶ÅÁ¥†„ÇíÁâπÂÆö
                                        if (node.classList && (
                                            node.classList.contains('vc-item') ||
                                            node.classList.contains('vc-log') ||
                                            node.className.includes('log')
                                        )) {
                                            const logText = node.textContent || node.innerText;
                                            if (logText && logText.trim().length > 5) {
                                                extractedLogs.push(`[DOM] ${logText.trim()}`);
                                            }
                                        }
                                    }
                                }
                                
                                // „Åæ„Å®„ÇÅ„Å¶„ÉÜ„Ç≠„Çπ„ÉàÊäΩÂá∫„ÇÇ„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Å®„Åó„Å¶‰øùÂ≠ò
                                if (allText.trim().length > 0) {
                                    extractedLogs.push(`[FULL_CONTENT] ${allText.trim()}`);
                                }
                                
                                break;
                            }
                        }
                    }
                }
                
                // ÊñπÊ≥ï3: ÊúÄÂæå„ÅÆÊâãÊÆµ - „Éñ„É©„Ç¶„Ç∂„Ç≥„É≥„ÇΩ„Éº„É´„É≠„Ç∞Â±•Ê≠¥„ÇíÂèñÂæó
                if (extractedLogs.length === 0) {
                    console.log('üîç Trying browser console history...');
                    if (window.console._logs) {
                        extractedLogs = window.console._logs.map((log, index) => 
                            `[${index + 1}] [BROWSER] ${log}`
                        );
                    } else {
                        // ÈùôÁöÑ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíËøΩÂä†
                        extractedLogs.push('[ERROR] Unable to extract logs from vConsole');
                        extractedLogs.push('[INFO] vConsole DOM structure may have changed');
                        extractedLogs.push('[DEBUG] Manual inspection of vConsole panel may be required');
                    }
                }
                
                // ÁµêÊûú„ÅÆÊúÄÁµÇÂá¶ÁêÜ„Å®„Ç≥„Éî„ÉºÂÆüË°å
                if (extractedLogs.length === 0) {
                    extractedLogs.push('[WARNING] No logs could be extracted');
                    extractedLogs.push('[INFO] This may indicate vConsole is not properly initialized');
                    extractedLogs.push('[SUGGESTION] Try refreshing the page and running tests to generate logs');
                }
                
                // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíÂê´„ÇÅ„Çã
                const debugInfo = [
                    `Debug Info:`,
                    `- vConsole Object: ${window.vConsole ? 'Found' : 'Not found'}`,
                    `- vConsole Tools: ${window.vConsole?.tool ? Object.keys(window.vConsole.tool).join(', ') : 'None'}`,
                    `- DOM Element: ${document.querySelector('#__vconsole') ? 'Found' : 'Not found'}`,
                    `- Extraction Method: ${extractedLogs.length > 0 ? 'Success' : 'Failed'}`,
                    `- Logs Extracted: ${extractedLogs.length}`,
                    ''
                ];
                
                const logText = [
                    '=== PixelCanvas vConsole Deep Logs ===',
                    `Exported: ${new Date().toLocaleString()}`,
                    `Total Logs: ${extractedLogs.length}`,
                    '=' .repeat(40),
                    '',
                    ...debugInfo,
                    ...extractedLogs,
                    '',
                    '=== End of Deep Logs ==='
                ].join('\n');
                
                copyToClipboard(logText);
                
                // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫
                const button = document.querySelector('.vc-copy-logs-btn') || 
                              document.querySelector('.vc-floating-copy-btn');
                if (button) {
                    const originalContent = button.innerHTML;
                    button.innerHTML = '‚úÖ Copied!';
                    button.style.background = '#2196F3';
                    setTimeout(() => {
                        button.innerHTML = originalContent;
                        button.style.background = '#4CAF50';
                    }, 1500);
                }
                
                console.log(`üìã Deep log extraction completed: ${extractedLogs.length} entries copied to clipboard`);
                
            } catch (error) {
                console.error('‚ùå Failed to copy logs:', error);
                alert('‚ùå „É≠„Ç∞„ÅÆ„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }
        
        // „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åô„ÇãÈñ¢Êï∞
        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                // Áèæ‰ª£ÁöÑ„Å™„Éñ„É©„Ç¶„Ç∂
                navigator.clipboard.writeText(text).catch(err => {
                    console.error('Clipboard API failed:', err);
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
                fallbackCopyTextToClipboard(text);
            }
        }
        
        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÈñ¢Êï∞
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                console.log('üìã Copied using fallback method');
            } catch (err) {
                console.error('‚ùå Fallback copy failed:', err);
            }
            
            document.body.removeChild(textArea);
        }
        
        // „Ç≥„Éî„Éº„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫
        function showCopyFeedback(element) {
            const original = element.innerHTML;
            element.innerHTML = '‚úÖ';
            element.style.color = '#4CAF50';
            setTimeout(() => {
                element.innerHTML = original;
                element.style.color = '';
            }, 1000);
        }
        
        // „Éñ„É©„Ç¶„Ç∂„Ç≥„É≥„ÇΩ„Éº„É´„É≠„Ç∞„ÇíÂèñÂæóÔºàÈôêÂÆöÁöÑÔºâ
        function getBrowserConsoleLogs() {
            // „Éñ„É©„Ç¶„Ç∂„ÅÆÂÆüÈöõ„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´„É≠„Ç∞„ÅØÂèñÂæó„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅ
            // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÂÜÖ„ÅßË®òÈå≤„Åï„Çå„Åü„É≠„Ç∞„ÇíËøî„Åô
            const logs = [];
            
            // Êó¢„Å´Âá∫Âäõ„Åï„Çå„Åüconsole.log„ÇíËøΩË∑°„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà
            if (window.pixelCanvas && window.pixelCanvas.logHistory) {
                return window.pixelCanvas.logHistory;
            }
            
            // vConsole„ÅÆAPI„Çí‰Ωø„Å£„Å¶„É≠„Ç∞„ÇíÂèñÂæó
            if (window.vConsole && window.vConsole.tool && window.vConsole.tool.default) {
                try {
                    const logTool = window.vConsole.tool.default;
                    if (logTool.logList) {
                        logTool.logList.forEach((log, index) => {
                            logs.push(`[${index + 1}] [${log.type.toUpperCase()}] ${log.data.join(' ')}`);
                        });
                    }
                } catch (error) {
                    console.error('Failed to get vConsole logs:', error);
                }
            }
            
            return logs;
        }
        
        // vConsole DOMÊßãÈÄ†„ÇíÂàÜÊûê
        function analyzeVConsoleStructure(element) {
            const analysis = [];
            
            // ‰∏ªË¶Å„Å™Â≠êË¶ÅÁ¥†„ÇíÂàÜÊûê
            const children = Array.from(element.children);
            analysis.push(`Total child elements: ${children.length}`);
            
            children.forEach((child, index) => {
                analysis.push(`Child ${index + 1}: ${child.tagName}.${child.className} (${child.children.length} children)`);
                
                // ÁâπÂÆö„ÅÆ„ÇØ„É©„Çπ„ÇíÊåÅ„Å§Ë¶ÅÁ¥†„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                if (child.classList.contains('vc-content') || child.classList.contains('vc-tabpanel')) {
                    const grandchildren = Array.from(child.children);
                    grandchildren.forEach((grandchild, gIndex) => {
                        analysis.push(`  ‚îî‚îÄ ${grandchild.tagName}.${grandchild.className} (text: "${grandchild.textContent?.substring(0, 50) || 'empty'}")`);
                    });
                }
            });
            
            // „É≠„Ç∞„Å´Èñ¢ÈÄ£„Åô„ÇãË¶ÅÁ¥†„ÇíÊ§úÁ¥¢
            const logElements = element.querySelectorAll('[class*="log"], [class*="item"], [class*="scroller"]');
            analysis.push(`Log-related elements found: ${logElements.length}`);
            
            Array.from(logElements).slice(0, 5).forEach((el, index) => {
                analysis.push(`Log element ${index + 1}: ${el.tagName}.${el.className}`);
            });
            
            return analysis;
        }
        
        // vConsole„É≠„Ç∞„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÂ±ïÈñã„Åô„ÇãÈñ¢Êï∞
        function expandAllLogObjects(element) {
            try {
                // Êäò„Çä„Åü„Åü„Åæ„Çå„Åü„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÊé¢„Åó„Å¶Â±ïÈñã
                const collapsedObjects = element.querySelectorAll('.vc-log-tree.vc-is-tree[data-keypath]');
                collapsedObjects.forEach(obj => {
                    // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„Çí„Ç∑„Éü„É•„É¨„Éº„Éà„Åó„Å¶Â±ïÈñã
                    if (obj.style.display !== 'none') {
                        const toggleElement = obj.querySelector('.vc-log-tree-title');
                        if (toggleElement) {
                            toggleElement.click();
                        }
                    }
                });
                
                // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„Çâ„Åï„Çâ„Å´Ê∑±„ÅÑÈöéÂ±§„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                setTimeout(() => {
                    const newCollapsedObjects = element.querySelectorAll('.vc-log-tree.vc-is-tree[data-keypath]');
                    newCollapsedObjects.forEach(obj => {
                        if (obj.style.display !== 'none') {
                            const toggleElement = obj.querySelector('.vc-log-tree-title');
                            if (toggleElement && !obj.classList.contains('expanded')) {
                                toggleElement.click();
                                obj.classList.add('expanded');
                            }
                        }
                    });
                }, 100);
                
            } catch (error) {
                console.error('Failed to expand log objects:', error);
            }
        }
        
        // vConsoleÂ∞ÇÁî®„ÅÆ„É≠„Ç∞ÂÜÖÂÆπÊäΩÂá∫
        function extractVConsoleLogContent(item) {
            try {
                let content = '';
                
                // vConsole„ÅÆÊßãÈÄ†„ÇíÁêÜËß£„Åó„Å¶ÊäΩÂá∫
                const logContent = item.querySelector('.vc-log-content');
                if (logContent) {
                    // ÊñáÂ≠óÂàóÈÉ®ÂàÜ„ÇíÂèñÂæó
                    const stringElements = logContent.querySelectorAll('.vc-log-val-string, .vc-log-val');
                    stringElements.forEach(el => {
                        content += el.textContent + ' ';
                    });
                    
                    // „Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÈÉ®ÂàÜ„ÇíÂèñÂæó
                    const objectElements = logContent.querySelectorAll('.vc-log-tree');
                    objectElements.forEach(obj => {
                        content += extractObjectContent(obj) + ' ';
                    });
                }
                
                return content.trim();
            } catch (error) {
                console.error('Failed to extract vConsole log content:', error);
                return '';
            }
        }
        
        // „Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÂÜÖÂÆπ„ÇíÂÜçÂ∏∞ÁöÑ„Å´ÊäΩÂá∫
        function extractObjectContent(objElement) {
            try {
                let content = '';
                
                // „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆ„Çø„Ç§„Éà„É´ÔºàÂûãÊÉÖÂ†±Ôºâ
                const title = objElement.querySelector('.vc-log-tree-title');
                if (title) {
                    content += title.textContent + ' ';
                }
                
                // „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆ„Éó„É≠„Éë„ÉÜ„Ç£
                const properties = objElement.querySelectorAll('.vc-log-tree-item');
                properties.forEach(prop => {
                    const key = prop.querySelector('.vc-log-tree-key');
                    const value = prop.querySelector('.vc-log-tree-val');
                    
                    if (key && value) {
                        content += `${key.textContent}: ${value.textContent} `;
                    } else if (value) {
                        content += `${value.textContent} `;
                    }
                    
                    // „Éç„Çπ„Éà„Åó„Åü„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇÇÂá¶ÁêÜ
                    const nestedObjects = prop.querySelectorAll('.vc-log-tree');
                    nestedObjects.forEach(nested => {
                        content += extractObjectContent(nested) + ' ';
                    });
                });
                
                return content;
            } catch (error) {
                console.error('Failed to extract object content:', error);
                return objElement.textContent || '';
            }
        }
        
        // „É≠„Ç∞ÂÜÖÂÆπ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        function cleanLogContent(content) {
            return content
                .replace(/\s+/g, ' ')  // Ë§áÊï∞„Çπ„Éö„Éº„Çπ„ÇíÂçò‰∏Ä„Å´
                .replace(/\n+/g, ' ')  // ÊîπË°å„Çí„Çπ„Éö„Éº„Çπ„Å´
                .replace(/\t+/g, ' ')  // „Çø„Éñ„Çí„Çπ„Éö„Éº„Çπ„Å´
                .replace(/üìã/g, '')    // „Ç≥„Éî„Éº„Ç¢„Ç§„Ç≥„É≥„ÇíÈô§Âéª
                .trim();
        }
        
        // ÂÆåÂÖ®Â±ïÈñã„É¢„Éº„Éâ„Åß„É≠„Ç∞„Ç≥„Éî„Éº
        function copyAllLogsExpanded() {
            console.log('üîç Starting comprehensive deep log extraction...');
            
            try {
                // vConsole„ÅÆAPI„ÇíÈÄö„Åò„Å¶ÂÆåÂÖ®„Å™„É≠„Ç∞„Éá„Éº„Çø„ÇíÂèñÂæó
                let comprehensiveLog = [];
                
                // ÊñπÊ≥ï1: vConsoleÂÜÖÈÉ®„Éá„Éº„Çø„ÅÆÂÆåÂÖ®„ÉÄ„É≥„Éó
                if (window.vConsole) {
                    console.log('üì± Extracting vConsole internal data...');
                    
                    // vConsole„ÅÆtool„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÊ∑±„ÅèÊé¢Á¥¢
                    if (window.vConsole.tool) {
                        for (const [toolName, tool] of Object.entries(window.vConsole.tool)) {
                            comprehensiveLog.push(`=== vConsole Tool: ${toolName} ===`);
                            
                            if (tool && tool.logList && Array.isArray(tool.logList)) {
                                comprehensiveLog.push(`Found ${tool.logList.length} logs in ${toolName}`);
                                
                                tool.logList.forEach((log, index) => {
                                    try {
                                        // ÂÆåÂÖ®„Å™„É≠„Ç∞„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÊñáÂ≠óÂàóÂåñ
                                        const timestamp = log.date ? new Date(log.date).toLocaleString() : 'no-time';
                                        const logType = log.type || 'unknown';
                                        
                                        // „Éá„Éº„Çø„ÇíË©≥Á¥∞„Å´Â±ïÈñã
                                        let logContent = '';
                                        if (Array.isArray(log.data)) {
                                            logContent = log.data.map(item => {
                                                if (typeof item === 'object') {
                                                    try {
                                                        return JSON.stringify(item, null, 2);
                                                    } catch {
                                                        return String(item);
                                                    }
                                                }
                                                return String(item);
                                            }).join(' | ');
                                        } else {
                                            logContent = String(log.data);
                                        }
                                        
                                        comprehensiveLog.push(`[${index + 1}] [${timestamp}] [${logType.toUpperCase()}] ${logContent}`);
                                        
                                        // „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆÂÆåÂÖ®„Å™JSON„ÉÄ„É≥„Éó„ÇÇÂê´„ÇÅ„Çã
                                        if (log.data && typeof log.data === 'object') {
                                            try {
                                                const fullObject = JSON.stringify(log.data, null, 2);
                                                if (fullObject.length > 20) {
                                                    comprehensiveLog.push(`    ‚îî‚îÄ FULL_OBJECT: ${fullObject}`);
                                                }
                                            } catch (error) {
                                                comprehensiveLog.push(`    ‚îî‚îÄ OBJECT_ERROR: ${error.message}`);
                                            }
                                        }
                                        
                                    } catch (error) {
                                        comprehensiveLog.push(`[ERROR_PROCESSING_LOG_${index}] ${error.message}`);
                                    }
                                });
                            } else {
                                comprehensiveLog.push(`No logList found in ${toolName}`);
                            }
                            comprehensiveLog.push(''); // Á©∫Ë°å
                        }
                    }
                    
                    // vConsole„ÅÆË®≠ÂÆöÊÉÖÂ†±„ÇÇÂê´„ÇÅ„Çã
                    comprehensiveLog.push('=== vConsole Configuration ===');
                    try {
                        const vcConfig = {
                            version: window.vConsole.version,
                            isInited: window.vConsole.isInited,
                            option: window.vConsole.option
                        };
                        comprehensiveLog.push(JSON.stringify(vcConfig, null, 2));
                    } catch (error) {
                        comprehensiveLog.push(`Config extraction failed: ${error.message}`);
                    }
                    comprehensiveLog.push('');
                }
                
                // ÊñπÊ≥ï2: „Éñ„É©„Ç¶„Ç∂„Ç≥„É≥„ÇΩ„Éº„É´„ÅÆÂ±•Ê≠¥„ÇÇÂèñÂæóÔºàÊã°ÂºµÔºâ
                comprehensiveLog.push('=== Browser Console History ===');
                if (console.log._original) {
                    comprehensiveLog.push('Console has been intercepted - original methods available');
                }
                
                // PixelCanvas„Ç¢„Éó„É™„ÅÆÁä∂ÊÖã„ÇÇÂê´„ÇÅ„Çã
                if (window.pixelCanvas) {
                    comprehensiveLog.push('=== PixelCanvas Application State ===');
                    try {
                        const appStats = window.pixelCanvas.getStats();
                        comprehensiveLog.push(JSON.stringify(appStats, null, 2));
                    } catch (error) {
                        comprehensiveLog.push(`App state extraction failed: ${error.message}`);
                    }
                    comprehensiveLog.push('');
                }
                
                // ÊñπÊ≥ï3: vConsole„ÅÆÂÆüÈöõ„ÅÆ„É≠„Ç∞„Ç®„É≥„Éà„É™„ÇíË©≥Á¥∞ÊäΩÂá∫
                comprehensiveLog.push('=== vConsole Log Entries Detail ===');
                
                // vConsole„ÅÆÂêÑ„Çø„Éñ„Åã„Çâ„É≠„Ç∞„ÇíÊäΩÂá∫
                const consoleTabs = ['default', 'console', 'system', 'network'];
                
                for (const tabName of consoleTabs) {
                    const tabPanel = document.querySelector(`#__vconsole .vc-tabpanel[data-tab="${tabName}"]`);
                    if (tabPanel) {
                        // „É≠„Ç∞„Ç®„É≥„Éà„É™„ÇíÊé¢„Åô
                        const logEntries = tabPanel.querySelectorAll('.vc-item, .vc-log-item, [class*="log"]');
                        
                        if (logEntries.length > 0) {
                            comprehensiveLog.push(`--- ${tabName.toUpperCase()} TAB (${logEntries.length} entries) ---`);
                            
                            Array.from(logEntries).slice(-50).forEach((entry, index) => {
                                // „É≠„Ç∞„Ç®„É≥„Éà„É™„ÅÆÂÖ®ÊÉÖÂ†±„ÇíÊäΩÂá∫
                                const timeStamp = entry.querySelector('.vc-item-time, .timestamp')?.textContent || 'no-time';
                                const logType = entry.className.includes('error') ? 'ERROR' : 
                                              entry.className.includes('warn') ? 'WARN' : 
                                              entry.className.includes('info') ? 'INFO' : 'LOG';
                                
                                // „É≠„Ç∞ÂÜÖÂÆπ„ÇíË§áÊï∞ÊñπÊ≥ï„ÅßÊäΩÂá∫
                                let content = '';
                                
                                // 1. „ÉÜ„Ç≠„Çπ„Éà„Ç≥„É≥„ÉÜ„É≥„ÉÑ
                                const textContent = entry.textContent || entry.innerText || '';
                                if (textContent && textContent.length > 10) {
                                    content = textContent.replace(/\s+/g, ' ').trim();
                                }
                                
                                // 2. dataÂ±ûÊÄß„Åã„Çâ„ÅÆÊäΩÂá∫
                                if (entry.dataset && Object.keys(entry.dataset).length > 0) {
                                    content += ` [DATA: ${JSON.stringify(entry.dataset)}]`;
                                }
                                
                                // 3. Â≠êË¶ÅÁ¥†„Åã„Çâ„ÅÆË©≥Á¥∞ÊäΩÂá∫
                                const childTexts = [];
                                entry.querySelectorAll('*').forEach(child => {
                                    const childText = child.textContent || child.innerText;
                                    if (childText && childText.trim().length > 0 && !childTexts.includes(childText.trim())) {
                                        childTexts.push(childText.trim());
                                    }
                                });
                                
                                if (childTexts.length > 0) {
                                    content += ` [DETAILS: ${childTexts.join(' | ')}]`;
                                }
                                
                                if (content && content.length > 5) {
                                    comprehensiveLog.push(`[${timeStamp}] [${logType}] ${content}`);
                                }
                            });
                        }
                    }
                }
                
                // ÊñπÊ≥ï4: vConsole„ÅÆ‰ªÆÊÉ≥„Çπ„ÇØ„É≠„Éº„É´ÂÜÖÂÆπ„ÇíÂº∑Âà∂ÁöÑ„Å´ÊäΩÂá∫
                const virtualScroller = document.querySelector('#__vconsole .vc-scroller');
                if (virtualScroller) {
                    comprehensiveLog.push('=== Virtual Scroller Content ===');
                    
                    // ‰ªÆÊÉ≥„Çπ„ÇØ„É≠„Éº„É´„ÅÆÂÖ®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÂº∑Âà∂Ë°®Á§∫
                    const scrollerItems = virtualScroller.querySelectorAll('.vc-item, [class*="log"], [class*="item"]');
                    
                    Array.from(scrollerItems).slice(-30).forEach((item, index) => {
                        const itemContent = item.textContent || item.innerText;
                        if (itemContent && itemContent.trim().length > 0) {
                            comprehensiveLog.push(`[SCROLL_${index}] ${itemContent.trim()}`);
                        }
                    });
                }
                
                // ÊúÄÁµÇÁöÑ„Å´DOMÂÖ®‰Ωì„Åã„Çâ„ÇÇÊäΩÂá∫
                const logList = document.querySelector('#__vconsole .vc-content') || 
                               document.querySelector('#__vconsole .vc-log-list');
                
                if (logList) {
                    expandAllLogObjects(logList);
                    
                    // DOMË¶ÅÁ¥†„Åã„Çâ„ÇÇÊäΩÂá∫
                    comprehensiveLog.push('=== DOM Element Content ===');
                    const allText = logList.textContent || logList.innerText;
                    if (allText && allText.trim().length > 0) {
                        comprehensiveLog.push(allText.trim());
                    }
                    comprehensiveLog.push('');
                }
                
                // ÊúÄÁµÇÁµêÊûú„ÅÆÁµÑ„ÅøÁ´ã„Å¶
                const finalLogText = [
                    '=== PixelCanvas COMPREHENSIVE Deep Log Extraction ===',
                    `Exported: ${new Date().toLocaleString()}`,
                    `Extraction Type: Complete Deep Analysis`,
                    `Total Entries: ${comprehensiveLog.length}`,
                    '=' .repeat(60),
                    '',
                    ...comprehensiveLog,
                    '',
                    '=== End of Comprehensive Deep Logs ==='
                ].join('\n');
                
                copyToClipboard(finalLogText);
                
                // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
                const button = document.querySelector('.vc-copy-logs-expanded-btn') || 
                              document.querySelector('.vc-floating-expand-btn');
                if (button) {
                    const originalContent = button.innerHTML;
                    button.innerHTML = '‚úÖ Deep Copied!';
                    button.style.background = '#4CAF50';
                    setTimeout(() => {
                        button.innerHTML = originalContent;
                        button.style.background = '#FF9800';
                    }, 2000);
                }
                
                console.log(`‚úÖ Comprehensive deep extraction completed: ${comprehensiveLog.length} entries`);
                
            } catch (error) {
                console.error('‚ùå Deep extraction failed:', error);
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ to normal extraction
                copyAllLogs();
            }
        }
        
        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶ÂÖ¨Èñã
        window.copyAllVConsoleLogs = copyAllLogs;
        window.copyAllVConsoleLogsExpanded = copyAllLogsExpanded; // Êñ∞Ê©üËÉΩ
        window.analyzeVConsoleDOM = () => {
            const vconsole = document.querySelector('#__vconsole');
            if (vconsole) {
                console.log('vConsole DOM Analysis:', analyzeVConsoleStructure(vconsole));
            } else {
                console.log('vConsole not found');
            }
        };
        
    </script>
    
    <script src="idb.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="main.js" defer></script>
</body>
</html>