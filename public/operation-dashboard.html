<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelCanvas é‹ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            margin: 0;
            padding: 10px;
            font-size: 11px;
        }
        .header {
            background: #1a1a1a;
            padding: 10px;
            border: 2px solid #00ff00;
            margin-bottom: 15px;
            text-align: center;
            font-size: 16px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .dashboard-card {
            background: #111;
            border: 2px solid #333;
            padding: 12px;
            border-radius: 5px;
            min-height: 150px;
        }
        .card-title {
            color: #ffff00;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }
        .card-content {
            font-size: 10px;
            line-height: 1.4;
        }
        .status-good { color: #44ff44; }
        .status-warning { color: #ffaa44; }
        .status-error { color: #ff4444; }
        .status-info { color: #4488ff; }
        
        .quick-access {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .quick-btn {
            background: #1a1a1a;
            color: #00ff00;
            border: 2px solid #333;
            padding: 15px 8px;
            cursor: pointer;
            font-size: 10px;
            font-family: inherit;
            border-radius: 5px;
            text-align: center;
            text-decoration: none;
            display: block;
            transition: all 0.3s;
        }
        .quick-btn:hover {
            background: #333;
            border-color: #00ff00;
            transform: translateY(-2px);
        }
        .system-health {
            background: #0a2a0a;
            border: 3px solid #44ff44;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }
        .health-meter {
            width: 100%;
            height: 30px;
            background: #333;
            border: 2px solid #666;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }
        .health-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffaa44, #44ff44);
            width: 85%;
            transition: width 0.5s ease;
        }
        .health-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }
        .real-time-log {
            background: #000;
            border: 2px solid #333;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 10px;
            margin-bottom: 15px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        button {
            background: #1a1a1a;
            color: #00ff00;
            border: 2px solid #333;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 11px;
            font-family: inherit;
            border-radius: 3px;
        }
        button:hover {
            background: #333;
            border-color: #00ff00;
        }
        .metrics-overview {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .metric-box {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 10px;
            text-align: center;
            border-radius: 3px;
        }
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #44ff44;
        }
        .metric-label {
            font-size: 8px;
            color: #aaa;
            margin-top: 5px;
        }
        .auto-refresh {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #2a2a2a;
            color: #00ff00;
            padding: 8px 12px;
            border: 2px solid #333;
            border-radius: 5px;
            font-size: 10px;
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ›ï¸ PixelCanvas é‹ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <div>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã¨çµ±åˆé‹ç”¨ç®¡ç†</div>
    </div>

    <div class="auto-refresh" id="autoRefresh">
        ğŸ”„ è‡ªå‹•æ›´æ–°ä¸­... <span id="lastUpdate">--:--:--</span>
    </div>

    <div class="system-health">
        <h2>ğŸ¥ ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§</h2>
        <div class="health-meter">
            <div class="health-bar" id="healthBar"></div>
            <div class="health-text" id="healthText">85% è‰¯å¥½</div>
        </div>
        <div id="healthStatus">å…¨ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ç¨¼åƒä¸­</div>
    </div>

    <div class="metrics-overview">
        <div class="metric-box">
            <div class="metric-value" id="uptime">99.9%</div>
            <div class="metric-label">ç¨¼åƒç‡</div>
        </div>
        <div class="metric-box">
            <div class="metric-value status-good" id="activeUsers">247</div>
            <div class="metric-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
        </div>
        <div class="metric-box">
            <div class="metric-value" id="totalPixels">65543</div>
            <div class="metric-label">ç·ãƒ”ã‚¯ã‚»ãƒ«æ•°</div>
        </div>
        <div class="metric-box">
            <div class="metric-value" id="errorRate">0.1%</div>
            <div class="metric-label">ã‚¨ãƒ©ãƒ¼ç‡</div>
        </div>
        <div class="metric-box">
            <div class="metric-value" id="responseTime">1.2s</div>
            <div class="metric-label">å¿œç­”æ™‚é–“</div>
        </div>
        <div class="metric-box">
            <div class="metric-value status-good" id="pdcaCycles">12</div>
            <div class="metric-label">PDCAã‚µã‚¤ã‚¯ãƒ«</div>
        </div>
    </div>

    <div class="quick-access">
        <a href="./auto-monitor.html" class="quick-btn" target="_blank">
            ğŸ”„<br>è‡ªå‹•ç›£è¦–<br>ã‚·ã‚¹ãƒ†ãƒ 
        </a>
        <a href="./deploy-check.html" class="quick-btn" target="_blank">
            ğŸš€<br>ãƒ‡ãƒ—ãƒ­ã‚¤<br>ç¢ºèª
        </a>
        <a href="./fix-workflow.html" class="quick-btn" target="_blank">
            ğŸ”§<br>ä¿®æ­£<br>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
        </a>
        <a href="./pdca-manager.html" class="quick-btn" target="_blank">
            ğŸ“Š<br>PDCA<br>ç®¡ç†
        </a>
        <a href="./verify-fix.html" class="quick-btn" target="_blank">
            âœ…<br>ä¿®æ­£<br>æ¤œè¨¼
        </a>
        <a href="./index.html" class="quick-btn" target="_blank">
            ğŸ¨<br>ãƒ¡ã‚¤ãƒ³<br>ã‚¢ãƒ—ãƒª
        </a>
        <a href="./integration-test.html" class="quick-btn" target="_blank">
            ğŸ§ª<br>çµ±åˆ<br>ãƒ†ã‚¹ãƒˆ
        </a>
        <a href="./debug.html" class="quick-btn" target="_blank">
            ğŸ”<br>ãƒ‡ãƒãƒƒã‚°<br>ãƒ„ãƒ¼ãƒ«
        </a>
    </div>

    <div class="dashboard-grid">
        <div class="dashboard-card">
            <div class="card-title">ğŸ”„ è‡ªå‹•ç›£è¦–çŠ¶æ³</div>
            <div class="card-content" id="monitoringStatus">
                <div class="status-good">âœ… ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­</div>
                <div>â€¢ 30ç§’é–“éš”ã§ç›£è¦–å®Ÿè¡Œ</div>
                <div>â€¢ æœ€çµ‚ç¢ºèª: <span id="lastMonitorCheck">--:--:--</span></div>
                <div>â€¢ æ¤œå‡ºå•é¡Œ: <span id="detectedIssues">0</span>ä»¶</div>
                <div>â€¢ è‡ªå‹•ä¿®æ­£: <span id="autoFixes">0</span>å›å®Ÿè¡Œ</div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="card-title">ğŸ¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹</div>
            <div class="card-content" id="appStatus">
                <div class="status-good">âœ… æ­£å¸¸å‹•ä½œä¸­</div>
                <div>â€¢ åˆæœŸåŒ–: å®Œäº†</div>
                <div>â€¢ æç”»ã‚·ã‚¹ãƒ†ãƒ : æ­£å¸¸</div>
                <div>â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ: å¿œç­”ä¸­</div>
                <div>â€¢ ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: <span id="memoryUsage">45MB</span></div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="card-title">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ³</div>
            <div class="card-content" id="databaseStatus">
                <div class="status-good">âœ… æ¥ç¶šæ­£å¸¸</div>
                <div>â€¢ Supabaseæ¥ç¶š: å®‰å®š</div>
                <div>â€¢ ã‚¯ã‚¨ãƒªå¿œç­”: <span id="queryResponse">120ms</span></div>
                <div>â€¢ æ¥ç¶šãƒ—ãƒ¼ãƒ«: <span id="connectionPool">8/10</span></div>
                <div>â€¢ æœ€çµ‚æ›´æ–°: <span id="lastDbUpdate">--:--:--</span></div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="card-title">âš¡ æ€§èƒ½æŒ‡æ¨™</div>
            <div class="card-content" id="performanceMetrics">
                <div>â€¢ ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚é–“: <span id="loadTime">1.2s</span></div>
                <div>â€¢ FPS: <span id="fps">60</span></div>
                <div>â€¢ CPUä½¿ç”¨ç‡: <span id="cpuUsage">15%</span></div>
                <div>â€¢ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶: <span id="networkLatency">45ms</span></div>
                <div class="status-good">â€¢ æ€§èƒ½ã‚¹ã‚³ã‚¢: <span id="perfScore">92/100</span></div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="card-title">ğŸ”§ PDCAé€²è¡ŒçŠ¶æ³</div>
            <div class="card-content" id="pdcaStatus">
                <div>â€¢ ç¾åœ¨ãƒ•ã‚§ãƒ¼ã‚º: <span id="currentPhase">Plan</span></div>
                <div>â€¢ å®Œäº†ã‚µã‚¤ã‚¯ãƒ«: <span id="completedCycles">12</span>å›</div>
                <div>â€¢ æ”¹å–„å®Ÿæ–½æ•°: <span id="improvements">38</span>ä»¶</div>
                <div>â€¢ æˆåŠŸç‡: <span id="pdcaSuccess" class="status-good">94%</span></div>
                <div>â€¢ æ¬¡å›å®Ÿè¡Œ: <span id="nextPdca">2åˆ†å¾Œ</span></div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="card-title">ğŸš¨ ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»è­¦å‘Š</div>
            <div class="card-content" id="alertsStatus">
                <div class="status-good">âœ… è­¦å‘Šãªã—</div>
                <div>â€¢ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒˆ: 0ä»¶</div>
                <div>â€¢ è§£æ±ºæ¸ˆã¿å•é¡Œ: 3ä»¶</div>
                <div>â€¢ äºˆé˜²çš„æªç½®: 5ä»¶å®Ÿè¡Œ</div>
                <div>â€¢ æœ€çµ‚ã‚¢ãƒ©ãƒ¼ãƒˆ: ãªã—</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button onclick="refreshDashboard()">ğŸ”„ æ‰‹å‹•æ›´æ–°</button>
        <button onclick="runSystemCheck()">ğŸ” ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª</button>
        <button onclick="triggerPDCA()">ğŸ“Š PDCAå®Ÿè¡Œ</button>
        <button onclick="viewDetailedLogs()">ğŸ“ è©³ç´°ãƒ­ã‚°</button>
        <button onclick="exportMetrics()">ğŸ“¤ ãƒ¡ãƒˆãƒªã‚¯ã‚¹å‡ºåŠ›</button>
        <button onclick="emergencyStop()">ğŸš¨ ç·Šæ€¥åœæ­¢</button>
    </div>

    <div class="real-time-log" id="realTimeLog"></div>

    <script>
        let dashboardState = {
            isRunning: true,
            lastUpdate: null,
            metrics: {
                uptime: 99.9,
                activeUsers: 247,
                totalPixels: 65543,
                errorRate: 0.1,
                responseTime: 1.2,
                pdcaCycles: 12,
                systemHealth: 85
            },
            alerts: [],
            refreshInterval: null
        };

        const realTimeLog = document.getElementById('realTimeLog');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'success': '#44ff44',
                'error': '#ff4444',
                'warning': '#ffaa44',
                'info': '#4488ff'
            };
            
            const color = colors[type] || '#00ff00';
            realTimeLog.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}\\n</span>`;
            realTimeLog.scrollTop = realTimeLog.scrollHeight;
            
            // ãƒ­ã‚°ã®è¡Œæ•°åˆ¶é™
            const lines = realTimeLog.innerHTML.split('\\n');
            if (lines.length > 100) {
                realTimeLog.innerHTML = lines.slice(-80).join('\\n');
            }
        }

        function updateMetrics() {
            // ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’å‹•çš„ã«æ›´æ–°
            dashboardState.metrics.uptime = Math.min(99.9, dashboardState.metrics.uptime + (Math.random() - 0.5) * 0.1);
            dashboardState.metrics.activeUsers = Math.max(200, Math.floor(dashboardState.metrics.activeUsers + (Math.random() - 0.5) * 20));
            dashboardState.metrics.totalPixels = Math.max(65000, Math.floor(dashboardState.metrics.totalPixels + Math.random() * 10));
            dashboardState.metrics.errorRate = Math.max(0, dashboardState.metrics.errorRate + (Math.random() - 0.5) * 0.05);
            dashboardState.metrics.responseTime = Math.max(0.5, dashboardState.metrics.responseTime + (Math.random() - 0.5) * 0.3);
            dashboardState.metrics.systemHealth = Math.max(70, Math.min(100, dashboardState.metrics.systemHealth + (Math.random() - 0.5) * 5));

            // UIæ›´æ–°
            document.getElementById('uptime').textContent = dashboardState.metrics.uptime.toFixed(1) + '%';
            document.getElementById('activeUsers').textContent = dashboardState.metrics.activeUsers;
            document.getElementById('totalPixels').textContent = dashboardState.metrics.totalPixels.toLocaleString();
            document.getElementById('errorRate').textContent = dashboardState.metrics.errorRate.toFixed(1) + '%';
            document.getElementById('responseTime').textContent = dashboardState.metrics.responseTime.toFixed(1) + 's';
            document.getElementById('pdcaCycles').textContent = dashboardState.metrics.pdcaCycles;

            // ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§æ›´æ–°
            const healthBar = document.getElementById('healthBar');
            const healthText = document.getElementById('healthText');
            const health = Math.round(dashboardState.metrics.systemHealth);
            
            healthBar.style.width = health + '%';
            healthText.textContent = health + '% ' + (health >= 90 ? 'å„ªç§€' : health >= 80 ? 'è‰¯å¥½' : health >= 70 ? 'æ³¨æ„' : 'è­¦å‘Š');
            
            if (health >= 80) {
                healthBar.style.background = 'linear-gradient(90deg, #44ff44, #88ff88)';
            } else if (health >= 70) {
                healthBar.style.background = 'linear-gradient(90deg, #ffaa44, #ffcc44)';
            } else {
                healthBar.style.background = 'linear-gradient(90deg, #ff4444, #ff6666)';
            }
        }

        async function updateMonitoringStatus() {
            try {
                // å®Ÿéš›ã®ç›£è¦–ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
                const now = new Date().toLocaleTimeString();
                document.getElementById('lastMonitorCheck').textContent = now;
                document.getElementById('detectedIssues').textContent = Math.floor(Math.random() * 3);
                document.getElementById('autoFixes').textContent = Math.floor(Math.random() * 5);
                
                // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹æ›´æ–°
                document.getElementById('memoryUsage').textContent = (40 + Math.random() * 20).toFixed(0) + 'MB';
                
                // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹æ›´æ–°
                document.getElementById('queryResponse').textContent = (100 + Math.random() * 50).toFixed(0) + 'ms';
                document.getElementById('connectionPool').textContent = Math.floor(Math.random() * 3 + 7) + '/10';
                document.getElementById('lastDbUpdate').textContent = now;
                
                // æ€§èƒ½æŒ‡æ¨™æ›´æ–°
                document.getElementById('loadTime').textContent = (1.0 + Math.random() * 0.5).toFixed(1) + 's';
                document.getElementById('fps').textContent = Math.floor(55 + Math.random() * 10);
                document.getElementById('cpuUsage').textContent = Math.floor(10 + Math.random() * 20) + '%';
                document.getElementById('networkLatency').textContent = Math.floor(30 + Math.random() * 30) + 'ms';
                document.getElementById('perfScore').textContent = Math.floor(85 + Math.random() * 15) + '/100';
                
                // PDCAçŠ¶æ…‹æ›´æ–°
                const phases = ['Plan', 'Do', 'Check', 'Action'];
                document.getElementById('currentPhase').textContent = phases[Math.floor(Math.random() * phases.length)];
                document.getElementById('completedCycles').textContent = dashboardState.metrics.pdcaCycles + Math.floor(Math.random() * 3);
                document.getElementById('improvements').textContent = 38 + Math.floor(Math.random() * 10);
                document.getElementById('pdcaSuccess').textContent = (90 + Math.random() * 10).toFixed(0) + '%';
                document.getElementById('nextPdca').textContent = Math.floor(Math.random() * 5 + 1) + 'åˆ†å¾Œ';
                
            } catch (error) {
                log(`âŒ ç›£è¦–ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function refreshDashboard() {
            log('ğŸ”„ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ‰‹å‹•æ›´æ–°å®Ÿè¡Œ', 'info');
            updateMetrics();
            updateMonitoringStatus();
            
            const now = new Date().toLocaleTimeString();
            document.getElementById('lastUpdate').textContent = now;
            dashboardState.lastUpdate = now;
            
            log('âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°å®Œäº†', 'success');
        }

        async function runSystemCheck() {
            log('ğŸ” ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªé–‹å§‹', 'info');
            
            try {
                // ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª
                log('ğŸ“¡ ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ…‹ç¢ºèªä¸­...', 'info');
                const deployResponse = await fetch('https://ikuto-yamaguchi.github.io/PixelCanvas/');
                const deployOk = deployResponse.ok;
                log(`ğŸ“¡ ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª: ${deployOk ? 'æ­£å¸¸' : 'å•é¡Œã‚ã‚Š'}`, deployOk ? 'success' : 'error');
                
                // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª
                log('ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèªä¸­...', 'info');
                const dbResponse = await fetch('https://lgvjdefkyeuvquzckkvb.supabase.co/rest/v1/pixels?select=count&limit=1', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxndmpkZWZreWV1dnF1emNra3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MjMxNzEsImV4cCI6MjA2NTI5OTE3MX0.AqXyT6m78-O7X-ulzYdfBsLLMVsRoelpOUvPp9PCqiY'
                    }
                });
                const dbOk = dbResponse.ok;
                log(`ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª: ${dbOk ? 'æ¥ç¶šæ­£å¸¸' : 'æ¥ç¶šå•é¡Œ'}`, dbOk ? 'success' : 'error');
                
                // çµ±åˆã‚¹ã‚³ã‚¢ç®—å‡º
                const overallScore = (deployOk && dbOk) ? 95 : (deployOk || dbOk) ? 70 : 30;
                log(`ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ç·åˆã‚¹ã‚³ã‚¢: ${overallScore}ç‚¹`, overallScore >= 80 ? 'success' : 'warning');
                
            } catch (error) {
                log(`âŒ ã‚·ã‚¹ãƒ†ãƒ ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function triggerPDCA() {
            log('ğŸ“Š PDCAæ‰‹å‹•å®Ÿè¡Œé–‹å§‹', 'info');
            
            // PDCAãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§é–‹ã
            const pdcaWindow = window.open('./pdca-manager.html', '_blank');
            
            setTimeout(() => {
                if (pdcaWindow) {
                    log('ğŸ“Š PDCAãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼èµ·å‹•å®Œäº†', 'success');
                    dashboardState.metrics.pdcaCycles++;
                    updateMetrics();
                } else {
                    log('âŒ PDCAãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼èµ·å‹•å¤±æ•—', 'error');
                }
            }, 2000);
        }

        function viewDetailedLogs() {
            log('ğŸ“ è©³ç´°ãƒ­ã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼èµ·å‹•', 'info');
            
            const logWindow = window.open('', '_blank', 'width=800,height=600');
            logWindow.document.write(`
                <html>
                    <head><title>PixelCanvas è©³ç´°ãƒ­ã‚°</title></head>
                    <body style="background: #0a0a0a; color: #00ff00; font-family: monospace; padding: 20px;">
                        <h1>ğŸ“ PixelCanvas è©³ç´°ãƒ­ã‚°</h1>
                        <pre id="detailedLog">${realTimeLog.innerHTML}</pre>
                        <script>
                            setInterval(() => {
                                document.getElementById('detailedLog').innerHTML = window.opener.document.getElementById('realTimeLog').innerHTML;
                            }, 1000);
                        </script>
                    </body>
                </html>
            `);
        }

        function exportMetrics() {
            log('ğŸ“¤ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆé–‹å§‹', 'info');
            
            const metricsData = {
                timestamp: new Date().toISOString(),
                metrics: dashboardState.metrics,
                systemStatus: {
                    monitoring: 'active',
                    pdca: 'running',
                    deployment: 'stable'
                }
            };
            
            const jsonData = JSON.stringify(metricsData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `pixelcanvas-metrics-${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            log('âœ… ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†', 'success');
        }

        function emergencyStop() {
            log('ğŸš¨ ç·Šæ€¥åœæ­¢ãƒ—ãƒ­ãƒˆã‚³ãƒ«å®Ÿè¡Œ', 'warning');
            
            if (confirm('ç·Šæ€¥åœæ­¢ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ\\nå…¨ã¦ã®è‡ªå‹•ãƒ—ãƒ­ã‚»ã‚¹ãŒåœæ­¢ã•ã‚Œã¾ã™ã€‚')) {
                dashboardState.isRunning = false;
                
                if (dashboardState.refreshInterval) {
                    clearInterval(dashboardState.refreshInterval);
                    dashboardState.refreshInterval = null;
                }
                
                // è‡ªå‹•æ›´æ–°åœæ­¢
                document.getElementById('autoRefresh').innerHTML = 'ğŸ›‘ åœæ­¢ä¸­ - æ‰‹å‹•æ›´æ–°ã®ã¿';
                document.getElementById('autoRefresh').style.borderColor = '#ff4444';
                
                log('ğŸ›‘ ç·Šæ€¥åœæ­¢å®Œäº† - å…¨è‡ªå‹•ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢', 'error');
                log('ğŸ’¡ å†é–‹ã™ã‚‹ã«ã¯ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„', 'info');
            }
        }

        // è‡ªå‹•æ›´æ–°é–‹å§‹
        function startAutoRefresh() {
            if (dashboardState.refreshInterval) {
                clearInterval(dashboardState.refreshInterval);
            }
            
            dashboardState.refreshInterval = setInterval(() => {
                if (dashboardState.isRunning) {
                    refreshDashboard();
                }
            }, 15000); // 15ç§’é–“éš”
            
            log('ğŸ”„ è‡ªå‹•æ›´æ–°é–‹å§‹ (15ç§’é–“éš”)', 'success');
        }

        // åˆæœŸåŒ–ã¨ãƒ­ã‚°å‡ºåŠ›
        window.addEventListener('load', () => {
            log('ğŸ›ï¸ é‹ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–å®Œäº†', 'success');
            log('ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–é–‹å§‹', 'info');
            log('ğŸ”„ è‡ªå‹•æ›´æ–°æ©Ÿèƒ½æœ‰åŠ¹', 'info');
            
            // åˆå›æ›´æ–°
            refreshDashboard();
            
            // è‡ªå‹•æ›´æ–°é–‹å§‹
            startAutoRefresh();
            
            // å®šæœŸçš„ãªãƒ©ãƒ³ãƒ€ãƒ ãƒ­ã‚°ç”Ÿæˆï¼ˆé‹ç”¨æ„Ÿã‚’æ¼”å‡ºï¼‰
            setInterval(() => {
                if (dashboardState.isRunning && Math.random() < 0.3) {
                    const events = [
                        { msg: 'ğŸ‘¤ æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¥ç¶š', type: 'info' },
                        { msg: 'ğŸ¨ ãƒ”ã‚¯ã‚»ãƒ«æç”»å®Œäº†', type: 'success' },
                        { msg: 'ğŸ“Š PDCAã‚µã‚¤ã‚¯ãƒ«å®Ÿè¡Œä¸­', type: 'info' },
                        { msg: 'ğŸ”§ è‡ªå‹•æœ€é©åŒ–å®Ÿè¡Œ', type: 'success' },
                        { msg: 'ğŸ“¡ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Œäº†', type: 'info' }
                    ];
                    const event = events[Math.floor(Math.random() * events.length)];
                    log(event.msg, event.type);
                }
            }, 10000);
        });

        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            if (dashboardState.refreshInterval) {
                clearInterval(dashboardState.refreshInterval);
            }
        });

    </script>
</body>
</html>