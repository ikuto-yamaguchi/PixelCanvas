<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelCanvas ä¿®æ­£æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            margin: 0;
            padding: 10px;
            font-size: 11px;
        }
        .header {
            background: #1a1a1a;
            padding: 8px;
            border: 1px solid #00ff00;
            margin-bottom: 10px;
            text-align: center;
            font-size: 14px;
        }
        .verification-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .test-section {
            background: #111;
            border: 1px solid #333;
            padding: 8px;
            border-radius: 3px;
        }
        .test-title {
            color: #ffff00;
            font-weight: bold;
            margin-bottom: 6px;
            font-size: 12px;
        }
        .pass { color: #44ff44; }
        .fail { color: #ff4444; }
        .warning { color: #ffaa44; }
        .info { color: #4488ff; }
        .result-area {
            background: #000;
            border: 1px solid #333;
            padding: 8px;
            height: 150px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 10px;
            margin-bottom: 10px;
        }
        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        button {
            background: #1a1a1a;
            color: #00ff00;
            border: 1px solid #333;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 10px;
            font-family: inherit;
        }
        button:hover {
            background: #333;
            border-color: #00ff00;
        }
        .summary {
            background: #1a1a1a;
            border: 2px solid #666;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }
        .canvas-preview {
            width: 200px;
            height: 200px;
            border: 1px solid #333;
            background: #000;
            margin: 5px auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ” PixelCanvas ä¿®æ­£æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </h1>
        <div>é‡è¦ä¿®æ­£ã®åŠ¹æœã‚’ç›´æ¥æ¤œè¨¼</div>
    </div>

    <div class="verification-grid">
        <div class="test-section">
            <div class="test-title">ğŸ¯ ã‚¢ãƒ—ãƒªåˆæœŸåŒ–æ¤œè¨¼</div>
            <div id="init-results"></div>
        </div>
        <div class="test-section">
            <div class="test-title">ğŸ¨ æç”»æ©Ÿèƒ½æ¤œè¨¼</div>
            <div id="render-results"></div>
        </div>
        <div class="test-section">
            <div class="test-title">ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼</div>
            <div id="data-results"></div>
        </div>
        <div class="test-section">
            <div class="test-title">âš™ï¸ è¨­å®šæ¤œè¨¼</div>
            <div id="config-results"></div>
        </div>
    </div>

    <div class="controls">
        <button onclick="runFullVerification()">ğŸš€ å®Œå…¨æ¤œè¨¼å®Ÿè¡Œ</button>
        <button onclick="testDirectPixelDraw()">ğŸ¨ ç›´æ¥æç”»ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="checkMainApp()">ğŸ“± ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªç¢ºèª</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
    </div>

    <div class="result-area" id="result-area"></div>

    <div class="summary" id="summary">
        æ¤œè¨¼å¾…æ©Ÿä¸­...
    </div>

    <!-- ãƒ†ã‚¹ãƒˆç”¨Canvas -->
    <canvas id="testCanvas" class="canvas-preview"></canvas>

    <script>
        const resultArea = document.getElementById('result-area');
        const summary = document.getElementById('summary');
        const initResults = document.getElementById('init-results');
        const renderResults = document.getElementById('render-results');
        const dataResults = document.getElementById('data-results');
        const configResults = document.getElementById('config-results');

        let verificationResults = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'pass': '#44ff44',
                'fail': '#ff4444', 
                'warning': '#ffaa44',
                'info': '#4488ff'
            };
            
            const color = colors[type] || '#00ff00';
            resultArea.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}\n</span>`;
            resultArea.scrollTop = resultArea.scrollHeight;

            // çµ±è¨ˆæ›´æ–°
            if (type === 'pass') verificationResults.passed++;
            else if (type === 'fail') verificationResults.failed++;
            else if (type === 'warning') verificationResults.warnings++;
            
            if (type !== 'info') {
                verificationResults.total++;
                updateSummary();
            }
        }

        function updateSummary() {
            const passRate = verificationResults.total > 0 ? 
                Math.round((verificationResults.passed / verificationResults.total) * 100) : 0;
            
            summary.innerHTML = `
                æ¤œè¨¼çµæœ: ${passRate}% æˆåŠŸ 
                (âœ…${verificationResults.passed} âŒ${verificationResults.failed} âš ï¸${verificationResults.warnings})
            `;
            
            if (passRate >= 80) summary.className = 'summary pass';
            else if (passRate >= 60) summary.className = 'summary warning';
            else summary.className = 'summary fail';
        }

        function clearResults() {
            resultArea.innerHTML = '';
            verificationResults = { total: 0, passed: 0, failed: 0, warnings: 0 };
            updateSummary();
        }

        // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–æ¤œè¨¼
        async function verifyAppInitialization() {
            log('ğŸ¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã‚’æ¤œè¨¼ä¸­...', 'info');
            
            let results = [];
            
            // PixelCanvas ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç¢ºèª
            const hasPixelCanvas = !!window.pixelCanvas;
            results.push(`PixelCanvas: ${hasPixelCanvas ? 'âœ…' : 'âŒ'}`);
            log(`PixelCanvas ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: ${hasPixelCanvas ? 'å­˜åœ¨' : 'æœªåˆæœŸåŒ–'}`, hasPixelCanvas ? 'pass' : 'fail');
            
            if (hasPixelCanvas) {
                try {
                    const stats = window.pixelCanvas.getStats();
                    const initialized = stats.initialized;
                    results.push(`åˆæœŸåŒ–: ${initialized ? 'âœ…' : 'âŒ'}`);
                    log(`åˆæœŸåŒ–çŠ¶æ…‹: ${initialized}`, initialized ? 'pass' : 'fail');
                    
                    if (stats.data) {
                        const pixelCount = stats.data.totalPixels || 0;
                        results.push(`ãƒ”ã‚¯ã‚»ãƒ«æ•°: ${pixelCount}`);
                        log(`ãƒ¡ãƒ¢ãƒªå†…ãƒ”ã‚¯ã‚»ãƒ«æ•°: ${pixelCount}`, pixelCount > 0 ? 'pass' : 'fail');
                    }
                } catch (error) {
                    results.push(`Statså–å¾—: âŒ`);
                    log(`çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
                }
            }
            
            initResults.innerHTML = results.join('<br>');
        }

        // æç”»æ©Ÿèƒ½æ¤œè¨¼
        async function verifyRenderingSystem() {
            log('ğŸ¨ æç”»ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¤œè¨¼ä¸­...', 'info');
            
            let results = [];
            
            // Canvasè¦ç´ ç¢ºèª
            const mainCanvas = document.getElementById('mainCanvas');
            results.push(`MainCanvas: ${mainCanvas ? 'âœ…' : 'âŒ'}`);
            log(`ãƒ¡ã‚¤ãƒ³Canvasè¦ç´ : ${mainCanvas ? 'å­˜åœ¨' : 'æœªç™ºè¦‹'}`, mainCanvas ? 'pass' : 'fail');
            
            if (mainCanvas) {
                const ctx = mainCanvas.getContext('2d');
                results.push(`Context: ${ctx ? 'âœ…' : 'âŒ'}`);
                log(`Canvas Context: ${ctx ? 'å–å¾—æˆåŠŸ' : 'å–å¾—å¤±æ•—'}`, ctx ? 'pass' : 'fail');
                
                if (ctx) {
                    // æç”»ãƒ†ã‚¹ãƒˆ
                    const testCanvas = document.getElementById('testCanvas');
                    testCanvas.width = 200;
                    testCanvas.height = 200;
                    const testCtx = testCanvas.getContext('2d');
                    
                    // ãƒ†ã‚¹ãƒˆæç”»å®Ÿè¡Œ
                    testCtx.fillStyle = '#FF0000';
                    testCtx.fillRect(10, 10, 8, 8);
                    testCtx.fillStyle = '#00FF00';
                    testCtx.fillRect(20, 10, 8, 8);
                    testCtx.fillStyle = '#0000FF';
                    testCtx.fillRect(30, 10, 8, 8);
                    
                    // æç”»ç¢ºèª
                    const imageData = testCtx.getImageData(10, 10, 1, 1);
                    const hasPixel = imageData.data[0] > 0;
                    results.push(`æç”»ãƒ†ã‚¹ãƒˆ: ${hasPixel ? 'âœ…' : 'âŒ'}`);
                    log(`æç”»ãƒ†ã‚¹ãƒˆ: ${hasPixel ? 'æˆåŠŸ' : 'å¤±æ•—'}`, hasPixel ? 'pass' : 'fail');
                }
            }
            
            renderResults.innerHTML = results.join('<br>');
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ æ¤œè¨¼
        async function verifyDataSystem() {
            log('ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¤œè¨¼ä¸­...', 'info');
            
            let results = [];
            
            try {
                // Supabaseæ¥ç¶šãƒ†ã‚¹ãƒˆ
                const response = await fetch('https://lgvjdefkyeuvquzckkvb.supabase.co/rest/v1/pixels?select=count&limit=1', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxndmpkZWZreWV1dnF1emNra3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MjMxNzEsImV4cCI6MjA2NTI5OTE3MX0.AqXyT6m78-O7X-ulzYdfBsLLMVsRoelpOUvPp9PCqiY',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxndmpkZWZreWV1dnF1emNra3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MjMxNzEsImV4cCI6MjA2NTI5OTE3MX0.AqXyT6m78-O7X-ulzYdfBsLLMVsRoelpOUvPp9PCqiY'
                    }
                });
                
                const dbConnected = response.ok;
                results.push(`DBæ¥ç¶š: ${dbConnected ? 'âœ…' : 'âŒ'}`);
                log(`Supabaseæ¥ç¶š: ${dbConnected ? 'æˆåŠŸ' : 'å¤±æ•—'}`, dbConnected ? 'pass' : 'fail');
                
                if (dbConnected) {
                    // ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
                    const dataResponse = await fetch('https://lgvjdefkyeuvquzckkvb.supabase.co/rest/v1/pixels?select=sector_x,sector_y,local_x,local_y,color&limit=3', {
                        headers: {
                            'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxndmpkZWZreWV1dnF1emNra3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MjMxNzEsImV4cCI6MjA2NTI5OTE3MX0.AqXyT6m78-O7X-ulzYdfBsLLMVsRoelpOUvPp9PCqiY',
                            'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxndmpkZWZreWV1dnF1emNra3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MjMxNzEsImV4cCI6MjA2NTI5OTE3MX0.AqXyT6m78-O7X-ulzYdfBsLLMVsRoelpOUvPp9PCqiY'
                        }
                    });
                    
                    if (dataResponse.ok) {
                        const data = await dataResponse.json();
                        results.push(`ãƒ‡ãƒ¼ã‚¿å–å¾—: ${data.length}ä»¶`);
                        log(`ãƒ‡ãƒ¼ã‚¿å–å¾—: ${data.length}ä»¶ã®ãƒ”ã‚¯ã‚»ãƒ«`, data.length > 0 ? 'pass' : 'warning');
                    }
                }
                
            } catch (error) {
                results.push(`DBæ¥ç¶š: âŒ`);
                log(`ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
            }
            
            dataResults.innerHTML = results.join('<br>');
        }

        // è¨­å®šæ¤œè¨¼
        async function verifyConfiguration() {
            log('âš™ï¸ è¨­å®šã‚’æ¤œè¨¼ä¸­...', 'info');
            
            let results = [];
            
            try {
                // Config.jsèª­ã¿è¾¼ã¿ç¢ºèª
                const configModule = await import('./Config.js');
                const CONFIG = configModule.CONFIG;
                
                results.push(`Configèª­ã¿è¾¼ã¿: âœ…`);
                log('Config.jsèª­ã¿è¾¼ã¿: æˆåŠŸ', 'pass');
                
                // é‡è¦è¨­å®šç¢ºèª
                const scale = CONFIG.DEFAULT_SCALE;
                results.push(`DEFAULT_SCALE: ${scale}`);
                log(`DEFAULT_SCALE: ${scale} ${scale >= 2.0 ? '(ä¿®æ­£æ¸ˆã¿)' : '(è¦ç¢ºèª)'}`, scale >= 2.0 ? 'pass' : 'warning');
                
                const pixelSize = CONFIG.PIXEL_SIZE;
                results.push(`PIXEL_SIZE: ${pixelSize}`);
                log(`PIXEL_SIZE: ${pixelSize}`, 'info');
                
                const gridSize = CONFIG.GRID_SIZE;
                results.push(`GRID_SIZE: ${gridSize}`);
                log(`GRID_SIZE: ${gridSize}`, 'info');
                
            } catch (error) {
                results.push(`Configèª­ã¿è¾¼ã¿: âŒ`);
                log(`è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
            }
            
            configResults.innerHTML = results.join('<br>');
        }

        // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªç¢ºèª
        function checkMainApp() {
            log('ğŸ“± ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèªä¸­...', 'info');
            
            // æ–°ã—ã„ã‚¿ãƒ–ã§ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚’é–‹ã
            const newWindow = window.open('./index.html', '_blank');
            
            setTimeout(() => {
                if (newWindow) {
                    log('ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã—ãŸ', 'info');
                    log('ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä»¥ä¸‹ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„:', 'info');
                    log('- ğŸ§ª Injected X test pixels for visualization', 'info');
                    log('- ğŸ¯ Viewport focused on sector (0,0)', 'info');
                    log('- ğŸ¨ Rendering with X total pixels', 'info');
                } else {
                    log('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ', 'warning');
                }
            }, 1000);
        }

        // ç›´æ¥æç”»ãƒ†ã‚¹ãƒˆ
        function testDirectPixelDraw() {
            log('ğŸ¨ ç›´æ¥æç”»ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...', 'info');
            
            const testCanvas = document.getElementById('testCanvas');
            testCanvas.width = 200;
            testCanvas.height = 200;
            const ctx = testCanvas.getContext('2d');
            
            // èƒŒæ™¯
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, 200, 200);
            
            // ãƒ†ã‚¹ãƒˆãƒ”ã‚¯ã‚»ãƒ«ï¼ˆä¿®æ­£ç‰ˆã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
            const testPixels = [
                { x: 10, y: 10, color: '#FF0000' },  // èµ¤
                { x: 18, y: 10, color: '#00FF00' },  // ç·‘  
                { x: 26, y: 10, color: '#0000FF' },  // é’
                { x: 10, y: 18, color: '#FFFF00' },  // é»„
                { x: 18, y: 18, color: '#FF00FF' },  // ãƒã‚¼ãƒ³ã‚¿
                { x: 26, y: 18, color: '#00FFFF' },  // ã‚·ã‚¢ãƒ³
                
                // ä¸­å¤®ä»˜è¿‘
                { x: 100, y: 100, color: '#FFFFFF' }, // ç™½
                { x: 108, y: 100, color: '#FF0000' }, // èµ¤
                { x: 100, y: 108, color: '#00FF00' }, // ç·‘
                { x: 108, y: 108, color: '#0000FF' }, // é’
            ];
            
            testPixels.forEach(pixel => {
                ctx.fillStyle = pixel.color;
                ctx.fillRect(pixel.x, pixel.y, 8, 8);
            });
            
            log(`ç›´æ¥æç”»å®Œäº†: ${testPixels.length}å€‹ã®ãƒ†ã‚¹ãƒˆãƒ”ã‚¯ã‚»ãƒ«`, 'pass');
            log('â†‘ ä¸Šã®Canvasè¦ç´ ã§æç”»çµæœã‚’ç¢ºèªã§ãã¾ã™', 'info');
        }

        // å®Œå…¨æ¤œè¨¼å®Ÿè¡Œ
        async function runFullVerification() {
            log('ğŸš€ å®Œå…¨æ¤œè¨¼ã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            clearResults();
            
            await verifyConfiguration();
            await verifyAppInitialization();
            await verifyRenderingSystem();
            await verifyDataSystem();
            
            log('âœ… å®Œå…¨æ¤œè¨¼å®Œäº†', 'info');
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ğŸ” ä¿®æ­£æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹', 'info');
                runFullVerification();
            }, 2000);
        });

    </script>
</body>
</html>