<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixelCanvas çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
        }
        .test-section {
            background: #2a2a2a;
            margin: 10px 0;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 5px;
        }
        .test-title {
            color: #ffff00;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .pass { color: #44ff44; }
        .fail { color: #ff4444; }
        .pending { color: #ffaa44; }
        .info { color: #4444ff; }
        #test-results {
            background: #000;
            color: #00ff00;
            font-family: monospace;
            padding: 10px;
            height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #444;
        }
        button {
            background: #333;
            color: #00ff00;
            border: 1px solid #666;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #444;
        }
        .summary {
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #666;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª PixelCanvas çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <div class="test-title">ğŸ“‹ ãƒ†ã‚¹ãƒˆæ¦‚è¦</div>
        <div>æ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å‹•ä½œç¢ºèª</div>
        <div>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã¨ãƒ”ã‚¯ã‚»ãƒ«è¡¨ç¤ºã®çµ±åˆãƒ†ã‚¹ãƒˆ</div>
        <div>ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ©Ÿèƒ½ã®æ­£å¸¸æ€§ç¢ºèª</div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ® ãƒ†ã‚¹ãƒˆåˆ¶å¾¡</div>
        <button onclick="runFullTest()">ğŸš€ å®Œå…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="runQuickTest()">âš¡ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ çµæœã‚¯ãƒªã‚¢</button>
        <button onclick="testPixelRendering()">ğŸ¨ ãƒ”ã‚¯ã‚»ãƒ«æç”»ãƒ†ã‚¹ãƒˆ</button>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</div>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ“ˆ ãƒ†ã‚¹ãƒˆçµ±è¨ˆ</div>
        <div id="test-summary" class="summary">
            ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾…æ©Ÿä¸­...
        </div>
    </div>

    <script type="module">
        const results = document.getElementById('test-results');
        const summary = document.getElementById('test-summary');
        
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            pending: 0
        };
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icons = {
                pass: 'âœ…',
                fail: 'âŒ', 
                pending: 'â³',
                info: 'â„¹ï¸',
                warning: 'âš ï¸'
            };
            
            const icon = icons[type] || 'â„¹ï¸';
            const msg = `[${timestamp}] ${icon} ${message}\n`;
            
            console.log(message);
            results.textContent += msg;
            results.scrollTop = results.scrollHeight;
            
            // çµ±è¨ˆæ›´æ–°
            if (type === 'pass') testStats.passed++;
            else if (type === 'fail') testStats.failed++;
            else if (type === 'pending') testStats.pending++;
            
            if (type !== 'info' && type !== 'warning') {
                testStats.total++;
                updateSummary();
            }
        }
        
        function updateSummary() {
            const passRate = testStats.total > 0 ? Math.round((testStats.passed / testStats.total) * 100) : 0;
            summary.innerHTML = `
                ğŸ“Š ãƒ†ã‚¹ãƒˆçµ±è¨ˆ (æˆåŠŸç‡: ${passRate}%)
                <br>âœ… æˆåŠŸ: ${testStats.passed}
                <br>âŒ å¤±æ•—: ${testStats.failed}
                <br>â³ ä¿ç•™: ${testStats.pending}
                <br>ğŸ“‹ åˆè¨ˆ: ${testStats.total}
            `;
            
            summary.className = 'summary ' + (passRate >= 80 ? 'pass' : passRate >= 60 ? 'pending' : 'fail');
        }
        
        function clearResults() {
            results.textContent = '';
            testStats = { total: 0, passed: 0, failed: 0, pending: 0 };
            updateSummary();
        }
        
        // åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        async function testBasicFunctionality() {
            log('ğŸ”§ åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            // ãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯
            const hasCanvas = !!document.createElement('canvas').getContext;
            log(`Canvas 2D ã‚µãƒãƒ¼ãƒˆ: ${hasCanvas}`, hasCanvas ? 'pass' : 'fail');
            
            const hasWebGL = !!document.createElement('canvas').getContext('webgl');
            log(`WebGL ã‚µãƒãƒ¼ãƒˆ: ${hasWebGL}`, hasWebGL ? 'pass' : 'fail');
            
            const hasIndexedDB = !!window.indexedDB;
            log(`IndexedDB ã‚µãƒãƒ¼ãƒˆ: ${hasIndexedDB}`, hasIndexedDB ? 'pass' : 'fail');
            
            const isOnline = navigator.onLine;
            log(`ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š: ${isOnline}`, isOnline ? 'pass' : 'fail');
        }
        
        // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        async function testModuleLoading() {
            log('ğŸ“¦ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            const modules = [
                './Config.js',
                './src/core/PixelCanvasCore.js',
                './src/core/StateManager.js',
                './src/data/PixelDataManager.js',
                './src/data/NetworkClient.js',
                './src/render/RenderStrategy.js',
                './src/render/Canvas2DRenderer.js'
            ];
            
            for (const modulePath of modules) {
                try {
                    const response = await fetch(modulePath);
                    const success = response.ok;
                    const moduleName = modulePath.split('/').pop();
                    log(`${moduleName}: ${success ? 'èª­ã¿è¾¼ã¿æˆåŠŸ' : `ã‚¨ãƒ©ãƒ¼ ${response.status}`}`, success ? 'pass' : 'fail');
                } catch (error) {
                    const moduleName = modulePath.split('/').pop();
                    log(`${moduleName}: èª­ã¿è¾¼ã¿å¤±æ•— - ${error.message}`, 'fail');
                }
            }
        }
        
        // Supabaseæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function testSupabaseConnection() {
            log('ğŸŒ Supabaseæ¥ç¶šãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            try {
                const response = await fetch('https://lgvjdefkyeuvquzckkvb.supabase.co/rest/v1/pixels?select=count&limit=1', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxndmpkZWZreWV1dnF1emNra3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MjMxNzEsImV4cCI6MjA2NTI5OTE3MX0.AqXyT6m78-O7X-ulzYdfBsLLMVsRoelpOUvPp9PCqiY',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxndmpkZWZreWV1dnF1emNra3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MjMxNzEsImV4cCI6MjA2NTI5OTE3MX0.AqXyT6m78-O7X-ulzYdfBsLLMVsRoelpOUvPp9PCqiY'
                    }
                });
                
                if (response.ok) {
                    log('Supabase APIæ¥ç¶š: æˆåŠŸ', 'pass');
                    
                    // ãƒ”ã‚¯ã‚»ãƒ«æ•°å–å¾—ãƒ†ã‚¹ãƒˆ
                    const countResponse = await fetch('https://lgvjdefkyeuvquzckkvb.supabase.co/rest/v1/pixels?select=*&limit=0', {
                        headers: {
                            'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxndmpkZWZreWV1dnF1emNra3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MjMxNzEsImV4cCI6MjA2NTI5OTE3MX0.AqXyT6m78-O7X-ulzYdfBsLLMVsRoelpOUvPp9PCqiY',
                            'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxndmpkZWZreWV1dnF1emNra3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3MjMxNzEsImV4cCI6MjA2NTI5OTE3MX0.AqXyT6m78-O7X-ulzYdfBsLLMVsRoelpOUvPp9PCqiY',
                            'Range': '0-0'
                        }
                    });
                    
                    const contentRange = countResponse.headers.get('content-range');
                    if (contentRange) {
                        const totalCount = contentRange.split('/')[1];
                        log(`ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ãƒ”ã‚¯ã‚»ãƒ«æ•°: ${totalCount}`, totalCount > 0 ? 'pass' : 'fail');
                    }
                } else {
                    log(`Supabase APIæ¥ç¶š: å¤±æ•— ${response.status}`, 'fail');
                }
            } catch (error) {
                log(`Supabaseæ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
            }
        }
        
        // ãƒ”ã‚¯ã‚»ãƒ«æç”»ãƒ†ã‚¹ãƒˆ
        async function testPixelRendering() {
            log('ğŸ¨ ãƒ”ã‚¯ã‚»ãƒ«æç”»ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            // ãƒ†ã‚¹ãƒˆç”¨Canvasä½œæˆ
            const testCanvas = document.createElement('canvas');
            testCanvas.width = 400;
            testCanvas.height = 400;
            const ctx = testCanvas.getContext('2d');
            
            if (ctx) {
                log('Canvas 2D Context: å–å¾—æˆåŠŸ', 'pass');
                
                // åŸºæœ¬æç”»ãƒ†ã‚¹ãƒˆ
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, 400, 400);
                log('èƒŒæ™¯æç”»: æˆåŠŸ', 'pass');
                
                // ãƒ†ã‚¹ãƒˆãƒ”ã‚¯ã‚»ãƒ«æç”»
                const testPixels = [
                    {x: 10, y: 10, color: '#FF0000'},
                    {x: 20, y: 10, color: '#00FF00'},
                    {x: 30, y: 10, color: '#0000FF'}
                ];
                
                testPixels.forEach((pixel, index) => {
                    ctx.fillStyle = pixel.color;
                    ctx.fillRect(pixel.x, pixel.y, 4, 4);
                });
                
                log(`ãƒ†ã‚¹ãƒˆãƒ”ã‚¯ã‚»ãƒ«æç”»: ${testPixels.length}å€‹æˆåŠŸ`, 'pass');
                
                // ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
                const imageData = ctx.getImageData(10, 10, 1, 1);
                const hasData = imageData.data[0] > 0 || imageData.data[1] > 0 || imageData.data[2] > 0;
                log(`ãƒ”ã‚¯ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿å–å¾—: ${hasData ? 'æˆåŠŸ' : 'å¤±æ•—'}`, hasData ? 'pass' : 'fail');
                
            } else {
                log('Canvas 2D Context: å–å¾—å¤±æ•—', 'fail');
            }
        }
        
        // PixelCanvasçµ±åˆãƒ†ã‚¹ãƒˆ
        async function testPixelCanvasIntegration() {
            log('ğŸ¯ PixelCanvasçµ±åˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
            const hasPixelCanvas = !!window.pixelCanvas;
            log(`PixelCanvas ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: ${hasPixelCanvas ? 'å­˜åœ¨' : 'æœªåˆæœŸåŒ–'}`, hasPixelCanvas ? 'pass' : 'pending');
            
            if (hasPixelCanvas) {
                try {
                    // çµ±è¨ˆæƒ…å ±å–å¾—ãƒ†ã‚¹ãƒˆ
                    const stats = window.pixelCanvas.getStats();
                    log(`çµ±è¨ˆæƒ…å ±å–å¾—: æˆåŠŸ`, 'pass');
                    log(`åˆæœŸåŒ–çŠ¶æ…‹: ${stats.initialized}`, stats.initialized ? 'pass' : 'fail');
                    
                    if (stats.data) {
                        const pixelCount = stats.data.totalPixels || 0;
                        log(`ãƒ¡ãƒ¢ãƒªå†…ãƒ”ã‚¯ã‚»ãƒ«æ•°: ${pixelCount}`, pixelCount > 0 ? 'pass' : 'fail');
                    }
                    
                    if (stats.rendering) {
                        log(`ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰: ${stats.rendering.mode}`, stats.rendering.mode ? 'pass' : 'fail');
                    }
                    
                } catch (error) {
                    log(`çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'fail');
                }
            }
        }
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        async function testPerformance() {
            log('âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            
            // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ†ã‚¹ãƒˆ
            if (performance.memory) {
                const memory = performance.memory;
                const memoryMB = Math.round(memory.usedJSHeapSize / 1024 / 1024);
                log(`JS Heapä½¿ç”¨é‡: ${memoryMB} MB`, memoryMB < 100 ? 'pass' : 'warning');
            }
            
            // åˆæœŸåŒ–æ™‚é–“æ¸¬å®š
            const start = performance.now();
            await new Promise(resolve => setTimeout(resolve, 100));
            const duration = performance.now() - start;
            log(`å¿œç­”æ™‚é–“ãƒ†ã‚¹ãƒˆ: ${duration.toFixed(2)}ms`, duration < 200 ? 'pass' : 'warning');
        }
        
        // ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
        async function runQuickTest() {
            log('âš¡ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            clearResults();
            
            await testBasicFunctionality();
            await testSupabaseConnection();
            await testPixelCanvasIntegration();
            
            log('âš¡ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†', 'info');
        }
        
        // å®Œå…¨ãƒ†ã‚¹ãƒˆ
        async function runFullTest() {
            log('ğŸš€ å®Œå…¨ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            clearResults();
            
            await testBasicFunctionality();
            await testModuleLoading();
            await testSupabaseConnection();
            await testPixelRendering();
            await testPixelCanvasIntegration();
            await testPerformance();
            
            log('ğŸš€ å®Œå…¨ãƒ†ã‚¹ãƒˆå®Œäº†', 'info');
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
        window.runFullTest = runFullTest;
        window.runQuickTest = runQuickTest;
        window.clearResults = clearResults;
        window.testPixelRendering = testPixelRendering;
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ğŸ”§ è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
                runQuickTest();
            }, 2000);
        });
    </script>
</body>
</html>